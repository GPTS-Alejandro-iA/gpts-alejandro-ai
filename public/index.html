<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alejandro - Green Power Tech Store</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      background: linear-gradient(135deg, #0f2b26 0%, #051b16 100%);
      height: 100vh; 
      display: flex; 
      align-items: flex-end; 
      justify-content: center; 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 10px;
    }
    #chat { 
      width: 100%; 
      max-width: 420px; 
      height: 92vh; 
      background: #0b141a; 
      border-radius: 24px; 
      overflow: hidden; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      display: flex; 
      flex-direction: column;
    }
    #header { 
      background: linear-gradient(135deg, #00a884, #008f6f); 
      color: white; 
      padding: 18px 16px; 
      display: flex; 
      align-items: center; 
      gap: 14px;
    }
    #avatar { 
      width: 48px; 
      height: 48px; 
      background: #00d95f; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 24px; 
      font-weight: bold;
    }
    #title { font-size: 18px; font-weight: 600; }
    #subtitle { font-size: 13px; opacity: 0.9; }
    #online { font-size: 12px; color: #7fffd4; margin-left:auto; }

    #messages { 
      flex: 1; 
      padding: 16px; 
      overflow-y: auto; 
      background: #0b141a;
      color: white;
    }
    .msg { 
      max-width: 78%; 
      margin: 8px 0; 
      padding: 10px 14px; 
      border-radius: 18px; 
      line-height: 1.45; 
      position: relative; 
      animation: fadeIn 0.3s ease;
      word-wrap: break-word;
    }
    .bot { 
      background: #ffffff; 
      color: #000; 
      align-self: flex-start; 
      border-bottom-left-radius: 4px; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
    .user { 
      background: #005c4b; 
      color: white; 
      align-self: flex-end; 
      border-bottom-right-radius: 4px; 
    }
    .time { font-size: 11px; opacity: 0.7; margin-top: 4px; text-align: right; }

    #input-area { 
      background: #111b21; 
      padding: 10px 16px; 
      display: flex; 
      gap: 10px; 
      align-items: center;
    }
    #input { 
      flex: 1; 
      padding: 14px 18px; 
      background: #202c33; 
      color: white; 
      border: none; 
      border-radius: 30px; 
      font-size: 16px; 
      outline: none;
    }
    #send { 
      background: #00a884; 
      color: white; 
      border: none; 
      width: 50px; 
      height: 50px; 
      border-radius: 50%; 
      font-size: 22px; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      transition: 0.2s;
    }
    #send:hover { background: #008f6f; transform: scale(1.08); }

    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:none; } }

    /* Loading spinner */
    #loading { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="chat">
    <div id="header">
      <div id="avatar">A</div>
      <div>
        <div id="title">Alejandro</div>
        <div id="subtitle">Green Power Tech Store</div>
      </div>
      <div id="online">en línea</div>
    </div>

    <div id="messages">
      <div class="bot msg">
        <strong>¡Hola!</strong> Soy Alejandro, experto en energía renovable de <strong>Green Power Tech Store</strong><br><br>
        Estoy aquí para orientarte sobre todos nuestros sistemas y ayudarte en el proceso de compra o preparación de una cotización preliminar para solicitar financiamiento.<br><br>
        ¿Cuál de nuestros sistemas te interesa conocer más?<br><br>
        <strong>1.</strong> Energía Solar Fuera de la red para residencias o negocios<br>
        <strong>2.</strong> Backups de Alta Capacidad para apartamentos u oficinas
        <div class="time">ahora</div>
      </div>
    </div>

    <div id="input-area">
      <input type="text" id="input" placeholder="Escribe tu mensaje..." autocomplete="off">
      <button id="send"><i class="fas fa-paper-plane"></i></button>
      <div id="loading" class="spinner"></div>
    </div>
  </div>

  <script>
    const msgs = document.getElementById("messages");
    const input = document.getElementById("input");
    const send = document.getElementById("send");
    const loading = document.getElementById("loading");
    const sessionId = Date.now();

    const add = (text, type) => {
      const div = document.createElement("div");
      div.className = "msg " + type;
      div.innerHTML = text.replace(/\n/g, "<br>") + 
        `<div class="time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
      msgs.appendChild(div);
      msgs.scrollTop = msgs.scrollHeight;
    };

    const enviar = async () => {
      const txt = input.value.trim();
      if (!txt) return;
      add(txt, "user");
      input.value = "";
      loading.style.display = "block";
      send.disabled = true;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: txt, sessionId })
        });
        const data = await res.json();
        add(data.reply || data.response || "Lo siento, no pude procesar tu mensaje.", "bot");
      } catch (e) {
        add("Error de conexión. Intenta de nuevo en unos segundos.", "bot");
      } finally {
        loading.style.display = "none";
        send.disabled = false;
      }
    };

    send.onclick = enviar;
    input.addEventListener("keypress", e => e.key === "Enter" && enviar());
  </script>
</body>
</html>
